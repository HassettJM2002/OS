2 Boxes -> 1 windows box and linux box
Download Copy To Workstation

xrdp in windows -> xfreerdp /u:andy.dwyer /v:_._._._ /dynamic-resolution +glyph-cache +clipboard
ssh to linux box -> ssh <user>@<IP>

net use * http://live.sysinternals.com

4 Linux questions
6 Windows questions

4 hour of notes

Title tells a lot
Look at connections
processes
artifacts
/etc/hosts
persistence

Windows
#######################
Network / Connections
#######################
  Netstat -anob
  Get-Nettcpconnections for Powershell.exe
     Look for ports that are strange
     Look for Meterpreter shell ports
  
Linux
  network
  Netstat -anop / ltup



#####################
Processes / Services
#####################
(1a) - Windows
  tasklist [/svc (services)]
  get-process | Sort -Property Id | more -> parent child relationship, who spawned who, look who spawned who, look for legitimate PIDs
  Get-Process | Select Name, Id, Description | Sort -Property Id | more
  
  
  Get-Ciminstance Win32_service | Select Name, Processid, Pathname | ft -wrap | more
  tasklist /m | more
  tasklist /m /fi "IMAGENAME eq chrome.exe"

  sc.exe query | more
  get-service
  Get-Service | Where-Object {$_.Status -eq "Running"}
  sc queryex type=service
  sc queryex type=service state=inactive
  net start
  Get-ScheduledTask | Select * | select -First 1
  chtasks /query /tn "IchBinBosh" /v /fo list
  HKLM\System\CurrentControlSet\Services

  System Processes run from C:\Windows\System32
  Chrome runs from C:\Program Files

(1b) - Linux
--Linux Processes
    Get Process: ps -elf
    Get Processes that spawned from parent with pid X: ps --ppid X -lf | head
    Visual Representation of tree: ps -elf --forest | tail 
    sysv -> systemctl command

--Linux Services
file /sbin/init, determine what commands to use with services
----SysV Services
      service <servicename> status/start/stop/restart

----SystemD Services
      Get Services
        systemctl list-units
        systemctl list-units --all
      Get the Status of a Service
        systemctl status <servicename.service>
        systemctl status <PID>

--CronJob
  /var/spool/cron
  /var/spool/cron/crontabs/
  /etc/cron.d
  /etc/crontab

  crontab -u [user] file This command will load the crontab data from the specified file
  crontab -l -u [user] This command will display/list user’s crontab contents
  crontab -r -u [user] This Command will remove user’s crontab contents
  crontab -e -u [user] This command will edit user’s crontab contents

--File Descriptors
    sudo lsof | tail -30
    sudo lsof -c sshd
--Proc Directories
    ls -l /proc/
    ps -elf | grep sshd
    sudo ls -l /proc/<PID>

#############
Artifacts
#############

#############
Persistance
#############
(1a) Windows ->
  - CMD.EXE
      reg query <Reg Key>
      reg delete <Reg Key> <Value>
  - Powershell.exe
      Read Subkeys: Get-Childitem <Reg Key>
      Get Value of Keys: Get-Item <Reg Key>      

(1b) Windows Important Registry Keys
  HKLM\Software\Microsoft\Windows\CurrentVersion\Run
  HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce
  HKU\<SID>\Software\Microsoft\Windows\CurrentVersion\Run
  HKU\<SID>\Software\Microsoft\Windows\CurrentVersion\RunOnce
  HKLM\SYSTEM\CurrentControlSet\services
  HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
  HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders
  HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon



start mechanism -> who turned on that process, what turned it on, what started that process, schtasks, user, cronjob

cronjob,schtasks,

persistence
registry
-the run keys are where persistence is usually located
scheduled tasks
-will find 
profiles
-powershell profiles, when startup and when powershell is run, $PSHOME
-linux profiles

net use * http://live.sysinternals.com

artifacts, where to find them, auditing and logging
cyber chef, encoding in rot13 find that one
locations, what info to look for

END OF REVIEW


Linux Notes:
  find if the machine is systemd or sysv
  file /sbin/init, see the symbolic link to the file

systemd
  systemctl list-units
  systemctl list-units --all

  systemctl status <servicename.service>
  systemctl status <PID of service>

  systemctl start/stop/restart <servicename.service>
sysv
  service <servicename> status/start/stop/restart

~/.bash ~/.bashrc ~./bash_profile
